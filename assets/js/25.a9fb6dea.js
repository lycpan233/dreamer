(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{385:function(e,r,t){"use strict";t.r(r);var v=t(0),s=Object(v.a)({},(function(){var e=this,r=e._self._c;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h2",{attrs:{id:"oauth"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#oauth"}},[e._v("#")]),e._v(" OAuth")]),e._v(" "),r("p",[r("strong",[e._v("开放授权（OAuth）"),r("strong",[e._v("是一个")]),e._v("开放标准")]),e._v("，允许用户让第三方应用访问该用户在某一网站上存储的私密的资源（如照片，视频，联系人列表），而无需将用户名和密码提供给第三方应用。")]),e._v(" "),r("p",[e._v("OAuth允许用户提供一个令牌，而不是用户名和密码来访问他们存放在特定服务提供者的数据。每一个令牌授权一个特定的网站（例如，视频编辑网站)在特定的时段（例如，接下来的2小时内）内访问特定的资源（例如仅仅是某一相册中的视频）。这样，OAuth让用户可以授权第三方网站访问他们存储在另外服务提供者的某些特定信息，而非所有内容。")]),e._v(" "),r("h2",{attrs:{id:"oauth-1-0"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#oauth-1-0"}},[e._v("#")]),e._v(" OAuth 1.0")]),e._v(" "),r("h3",{attrs:{id:"基础概念"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#基础概念"}},[e._v("#")]),e._v(" 基础概念")]),e._v(" "),r("h4",{attrs:{id:"角色划分"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#角色划分"}},[e._v("#")]),e._v(" 角色划分")]),e._v(" "),r("p",[e._v("OAuth 1.0 授权流程中涉及三个角色： Service Provider、User、Customer。")]),e._v(" "),r("ul",[r("li",[e._v("Service Provider:\n"),r("ul",[r("li",[e._v("资源所有者，允许通过 OAuth 访问的应用主体。")])])]),e._v(" "),r("li",[e._v("User：\n"),r("ul",[r("li",[e._v("在 Service Provider 拥有账户的个人。")])])]),e._v(" "),r("li",[e._v("Customer：\n"),r("ul",[r("li",[e._v("三方应用，代表 User 使用 OAuth 访问 Service Provider 的资源。")])])])]),e._v(" "),r("p",[e._v("举一个例子方便大家理解这三个角色：")]),e._v(" "),r("p",[e._v("​\t我通过微信登录极客时间~~（没收广告费）~~。其中 我（User）、极客时间（Customer）、微信（Service Provider），从用户的角度看，整个流程就是极客时间（Customer）通过唤起微信（Service Provider）让我（User）扫码登录微信（Service Provider）进行授权，授权成功后也成功登录了极客时间（Cusotmer）。")]),e._v(" "),r("p",[r("s",[e._v("（这个例子可能有一些不恰当的地方，比如真实场景里，它们的授权方式可能不是本文提到的 OAuth1.0，便于大家理解这块的概念，不用过于纠结）")])]),e._v(" "),r("h3",{attrs:{id:"授权流程"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#授权流程"}},[e._v("#")]),e._v(" 授权流程")]),e._v(" "),r("p",[e._v("OAuth 1.0 授权分为三步：")]),e._v(" "),r("ol",[r("li",[e._v("Customer 获取未授权的 Request Token。")]),e._v(" "),r("li",[e._v("User 授权 Request Token。")]),e._v(" "),r("li",[e._v("Customer 通过授权过的 Request Token 换取 Access Token。")])]),e._v(" "),r("p",[r("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/lycpan233/img/blog/diagram.png",alt:"diagram"}})]),e._v(" "),r("hr"),e._v(" "),r("h4",{attrs:{id:"获取未授权的-request-token"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#获取未授权的-request-token"}},[e._v("#")]),e._v(" 获取未授权的 Request Token")]),e._v(" "),r("blockquote",[r("p",[e._v("Request Token 的作用是接收 User 授权，并且只能用于换取 Access Token。")])]),e._v(" "),r("ol",[r("li",[e._v("Customer 获取 Request Token")])]),e._v(" "),r("p",[e._v("Customer 根据 Service Provider 提供的文档，构造  HTTP 请求。当前请求的参数包含，Service Provider 颁发的身份信息、约定的额外参数及签名等。")]),e._v(" "),r("ol",{attrs:{start:"2"}},[r("li",[e._v("Service Provider 发放未授权的 Request Token")])]),e._v(" "),r("p",[e._v("Service Provider 会对 Customer 的请求进行校验，校验通过后它会生成 Request Token 和 Token Secret 并作为参数响应。")]),e._v(" "),r("p",[e._v("响应里会包含两个关键参数：")]),e._v(" "),r("p",[r("strong",[e._v("oauth_token")]),e._v("： Request Token。")]),e._v(" "),r("p",[r("strong",[e._v("oauth_token_secret")]),e._v("： Token Secret。")]),e._v(" "),r("h4",{attrs:{id:"获取-user-授权"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#获取-user-授权"}},[e._v("#")]),e._v(" 获取 User 授权")]),e._v(" "),r("blockquote",[r("p",[e._v("Request Token 在未得到 User 授权之前是无法使用的。")])]),e._v(" "),r("ol",[r("li",[e._v("Customer 引导 User 到 Service Provider")])]),e._v(" "),r("p",[e._v("Customer 想要将 Request Token 换成 Access Token，需要先让 User 在 Service Provider 处对 Request Token 进行授权。")]),e._v(" "),r("p",[e._v("Customer 可以通过以下参数，构造一个HTTP的 Get 请求，请求地址指向 Service Provider 的『用户授权 URL』。")]),e._v(" "),r("p",[r("strong",[e._v("oauth_token")]),e._v("：上一步返回的  Token， 可以根据 Service Provider 的声明，选择是拼接到 URL 上还是让用户输入。")]),e._v(" "),r("p",[r("strong",[e._v("oauth_callback")]),e._v("： Customer 提供的回调地址，User 授权完毕后会被重定向到该地址。")]),e._v(" "),r("ol",{attrs:{start:"2"}},[r("li",[e._v("Service Provider 认证 User 并获取授权许可")])]),e._v(" "),r("p",[e._v("OAuth 没有指定 Service Provider 如何认证 User 的身份，但是它提供了一组必要的验证步骤。")]),e._v(" "),r("ul",[r("li",[e._v("Service Provider 必须先验证 User 的身份。如果 User 没登录，可能需要 User 进行登录。")]),e._v(" "),r("li",[e._v("Service Provider 需要向 User 展示 Customer 索取的资源信息（相关的资源需要 Customer 的开发者，之前已经在 Service Provider 申请过）。")]),e._v(" "),r("li",[e._v("User 必须允许或者拒绝授权。如果 User 拒绝授权，那么 Service Provider 将不允许访问受限资源。")])]),e._v(" "),r("ol",{attrs:{start:"3"}},[r("li",[e._v("Service Provider 引导用户返回 Customer")])]),e._v(" "),r("p",[e._v("User 允许或者拒绝授权， Service Provider 需要通知 Customer 授权结果。")]),e._v(" "),r("p",[e._v("如果 Customer 在 "),r("strong",[e._v("oauth_callback")]),e._v(" 中提供了一个回调 URL。Service Provider 将构造一个 HTTP  Get 请求 URL，并使用以下参数将  User 重定向到该 URL。")]),e._v(" "),r("p",[r("strong",[e._v("oauth_token:")]),e._v("  User 允许/拒绝授权的 Request Token")]),e._v(" "),r("h4",{attrs:{id:"获取-access-token"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#获取-access-token"}},[e._v("#")]),e._v(" 获取 Access Token")]),e._v(" "),r("blockquote",[r("p",[e._v("Customer 将 Request Token 换为能够访问 User 资源的 Access Token。")])]),e._v(" "),r("ol",[r("li",[e._v("Customer 请求获取 Access Token")])]),e._v(" "),r("p",[e._v("Customer 根据 Service Provider 提供的文档，构造  HTTP 请求。请求参数包括上一步获取的 "),r("strong",[e._v("oauth_token")]),e._v("。")]),e._v(" "),r("ol",{attrs:{start:"2"}},[r("li",[e._v("Service Provider 授予 Access Token")])]),e._v(" "),r("p",[e._v("Service Provider 需要确保：")]),e._v(" "),r("ul",[r("li",[e._v("请求签名已经成功验证。")]),e._v(" "),r("li",[e._v("Request Token 不存在重复兑换。")]),e._v(" "),r("li",[e._v("Request Token 与 Customer 的密钥匹配。")])]),e._v(" "),r("p",[e._v("如果校验成功 Service Provider 将会生成 Access Token 和 Token Secret ，并将其作为参数响应。")]),e._v(" "),r("p",[r("strong",[e._v("oauth_token")]),e._v("： Access Token。")]),e._v(" "),r("p",[r("strong",[e._v("oauth_token_secret")]),e._v("： Token Secret。")]),e._v(" "),r("h3",{attrs:{id:"安全问题"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#安全问题"}},[e._v("#")]),e._v(" 安全问题")]),e._v(" "),r("p",[e._v("OAuth 1.0 存在会话固定攻击（ "),r("a",{attrs:{href:"http://oauth.net/advisories/2009-1/",target:"_blank",rel:"noopener noreferrer"}},[e._v("session fixation attack"),r("OutboundLink")],1),r("strong",[e._v(".")]),e._v("）风险目前已经废弃。")]),e._v(" "),r("h2",{attrs:{id:"相关链接"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#相关链接"}},[e._v("#")]),e._v(" 相关链接")]),e._v(" "),r("p",[r("a",{attrs:{href:"https://zh.wikipedia.org/wiki/%E5%BC%80%E6%94%BE%E6%8E%88%E6%9D%83",target:"_blank",rel:"noopener noreferrer"}},[e._v("开放授权 - 维基百科，自由的百科全书 (wikipedia.org)"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"https://oauth.net/core/1.0/",target:"_blank",rel:"noopener noreferrer"}},[e._v("OAuth Core 1.0"),r("OutboundLink")],1)])])}),[],!1,null,null,null);r.default=s.exports}}]);