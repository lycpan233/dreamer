(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{393:function(t,a,_){"use strict";_.r(a);var v=_(0),n=Object(v.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"背景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[t._v("#")]),t._v(" 背景")]),t._v(" "),a("p",[t._v("今天下载依赖的时候，突然报错 "),a("code",[t._v("WARN  GET https://registry.npm.taobao.org/cz-conventional-changelog error (CERT_HAS_EXPIRED).")]),t._v(" ，查阅信息以后发现是淘宝源的域名过期了。\n后来就尝试更换域名进行下载包。发现不论是 CLI 更改，还是项目中的 .npmrc 更改都不生效。\n纠结一天终于找到了原因。")]),t._v(" "),a("h2",{attrs:{id:"复现场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#复现场景"}},[t._v("#")]),t._v(" 复现场景")]),t._v(" "),a("p",[t._v("本地设置淘宝源， 项目设置私有仓库（下载私有包需要）。")]),t._v(" "),a("ol",[a("li",[t._v("pnpm 下载所有依赖")]),t._v(" "),a("li",[t._v("域名过期后尝试多重换源方式。\n"),a("ol",[a("li",[t._v("本地换源。")]),t._v(" "),a("li",[t._v("项目换源。")]),t._v(" "),a("li",[t._v("指定临时源。")])])])]),t._v(" "),a("p",[t._v("众所周知，npm 下包取源的规则是 "),a("code",[t._v("临时 => 项目 => 用户 => 全局")]),t._v(" 。")]),t._v(" "),a("p",[t._v("但是在实际使用过程中有一个非常诡异的 case ，就是我本地项目注释源配置。\n此时不论是采用临时指定源，还是使用某人源下载包均失败。\n如图所示：\n"),a("img",{attrs:{src:"https://jsd.cdn.zzko.cn/gh/lycpan233/img/blog/A78B22F3-832B-4CDE-BE3A-F169C014899A.png",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"结论"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#结论"}},[t._v("#")]),t._v(" 结论")]),t._v(" "),a("p",[t._v("经过验证，发现 pnpm 会记录首次下载依赖的源配置，在 add 新依赖的时候，它会对旧依赖从旧源里进行比对（这里是推测）。当项目里没有配置源的时候，它就采用了它记录的默认源地址。\n这时候因为淘宝源的域名问题，导致访问失败。从而没办法下载新包。")]),t._v(" "),a("h2",{attrs:{id:"解决方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决方式"}},[t._v("#")]),t._v(" 解决方式")]),t._v(" "),a("ol",[a("li",[t._v("配置正确的源地址，私有包链接私有仓库，三方包走能用的镜像源站。")]),t._v(" "),a("li",[a("code",[t._v("rm -rf node_moduls")])]),t._v(" "),a("li",[a("code",[t._v("pnpm install")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);